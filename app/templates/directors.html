{% extends "base.html" %}
{% set active_nav = "directors" %}

{% block title %}Directors - The Mubi 1000{% endblock %}
{% block heading %}Directors{% endblock %}
{% block subheading %}Browse the Mubi 1000 by director{% endblock %}

{% block content %}
    <!-- Search -->
    <section class="bg-gray-800 rounded-lg shadow-md p-4 mb-8">
        <input type="text" id="searchInput"
               class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-100"
               placeholder="Search directors...">
    </section>

    <!-- Loading -->
    <div id="loading" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <p class="mt-2 text-gray-400">Loading directors...</p>
    </div>

    <!-- Directors List -->
    <section id="directorsContent" class="bg-gray-800 rounded-lg shadow-md p-6 hidden">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-gray-100"><span id="directorCount">0</span> Directors</h2>
        </div>
        <div id="directorsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </section>
{% endblock %}

{% block scripts %}
<script>
    let allDirectors = [];

    async function loadDirectors() {
        try {
            const directors = await apiFetch(BASE + '/api/directors');

            allDirectors = directors;
            displayDirectors(directors);

            document.getElementById('loading').classList.add('hidden');
            document.getElementById('directorsContent').classList.remove('hidden');

        } catch (error) {
            console.error('Error loading directors:', error);
            alert(error.message);
        }
    }

    function displayDirectors(directors) {
        const container = document.getElementById('directorsList');
        document.getElementById('directorCount').textContent = directors.length;

        container.innerHTML = directors.map(d => `
            <a href="${BASE}/director/${encodeURIComponent(d.name)}"
               class="director-card flex justify-between items-center bg-gray-700 rounded-lg p-4">
                <span class="text-gray-100 font-medium">${d.name}</span>
                <span class="text-blue-400 bg-blue-900 px-2 py-1 rounded text-sm">${d.count} film${d.count !== 1 ? 's' : ''}</span>
            </a>
        `).join('');
    }

    function filterDirectors(query) {
        query = query.toLowerCase();
        const filtered = allDirectors.filter(d => d.name.toLowerCase().includes(query));
        displayDirectors(filtered);
    }

    document.getElementById('searchInput').addEventListener('input', function(e) {
        filterDirectors(e.target.value);
    });

    document.addEventListener('DOMContentLoaded', loadDirectors);
</script>
{% endblock %}
